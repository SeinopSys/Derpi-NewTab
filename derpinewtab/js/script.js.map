{"version":3,"sources":["script.js"],"names":["$","getJSON","data","text","version","settings","allowedTags","metadata","undefined","filterID","$settingsWrap","$settings","everythingFilterID","$tagSettings","$body","$metaSettings","$cropSettings","$image","$imageGhost","$fadeLayer","$data","$style","$filterID","$filterIDSelect","$signinFilter","$usefilterInput","find","$showSettingsButton","_currentImageURL","html","image_url","reQuest","ajax","replace","url","success","crop","image","styles","imgElement","downvotes","cachedurl","tags","split","artists","each","i","el","append","updateMetadataSettings","setBackgroundStyles","list","separator","list_str","length","list_str_len","maxDest","splice","join","textify","fadeOutData","children","simplemarquee","movetimeout","hideFunction","space","handleHover","delayBetweenCycles","cc","document","css","votestr","on","upvotes","removeClass","triggerHandler","created_at","uploader","fc","window","fadeIt","slideUp","has","LStorage","get","Image","addClass","indexOf","page","getCachedIMGURL","width","height","error","sha512_hash","comment_count","src","set","speed","cycles","Infinity","navigator","onLine","setTimeout","createElement","throttle","attr","e","preventDefault","$dialog","this","your","global","$optg","userpage","$filter","id","parseInt","name","val","tagselectTimeout","setTags","possibleTags","push","$systags","type","tagselectCountdownInterval","clearInterval","tagSelectCountdown","$elem","parent","$input","stop","hide","slideDown","tagArray","setInterval","filterCond","isNaN","tag","tagsCond","del","unbindHandlers","prop","$thisInput","prev","tagSelectCountdownStarter","checked","filterid","trigger","$this","currFilter","test","MatadataSettings","keys","is","$inputs","noupdatekeys","nameAttr","attrIndx","filter","last","Object","stopPropagation","setTo","$select","updateCroppingSettings","remove","end","prependTo","material_select"],"mappings":"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","file":"script.js","sourcesContent":["/* global LStorage,updateMetadataSettings */\n$(function(){\n\t'use strict';\n\n\t$.getJSON('manifest.json',function(data){\n\t\tif (!data) return;\n\n\t\t$('#disp-version').text(' v'+data.version);\n\t});\n\n\t//Setting check\n\tlet settings = {\n\t\t\tallowedTags: [],\n\t\t\tmetadata: {},\n\t\t\tcrop: undefined,\n\t\t\tfilterID: undefined,\n\t\t},\n\t\teverythingFilterID = 56027,\n\t\t$settingsWrap = $('#settingsWrap'),\n\t\t$settings = $('#settings'),\n\t\t$tagSettings = $('#tag-settings'),\n\t\t$body = $('body'),\n\t\t$metaSettings = $('#metadata-settings'),\n\t\t$cropSettings = $('#crop-settings'),\n\t\t$image = $('#image'),\n\t\t$imageGhost = $('#image-ghost'),\n\t\t$fadeLayer = $('#fade-layer'),\n\t\t$data = $('#data'),\n\t\t$style = $('#style'),\n\t\t$filterID = $('#filter-id'),\n\t\t$filterIDSelect = $('#filter-id-select'),\n\t\t$signinFilter = $('#signin-filter'),\n\t\t$usefilterInput = $tagSettings.find('.usefilter input'),\n\t\t$showSettingsButton = $('#show-settings-button'),\n\t\t_currentImageURL;\n\n\t$.get('https://derpibooru.org/filters',function(data){\n\t\tlet $data = $(data.replace(/src=\"[^\"]+?\"/g,'')),\n\t\t\t$optg = {\n\t\t\t\tyour: $(document.createElement('optgroup')).attr('label','My Filters'),\n\t\t\t\tglobal: $(document.createElement('optgroup')).attr('label','Global Filters'),\n\t\t\t},\n\t\t\tuserpage = $data.find('.header__link.header__link-user').attr('href');\n\n\t\tif (!userpage){\n\t\t\t$signinFilter.addClass('nope').attr('title','You must be signed in on Derpibooru.org to see your own filters.');\n\t\t}\n\n\t\t$data.find('.filter').each(function(){\n\t\t\tlet $filter = $(this),\n\t\t\t\tname = $filter.children('h3').text(),\n\t\t\t\tid = parseInt($filter.children('.filter-options').find('a[href^=\"/filters/\"]').attr('href').replace(/\\D/g,''), 10);\n\n\t\t\tif (id === everythingFilterID)\n\t\t\t\treturn;\n\n\t\t\t$optg[$filter.find('a[href=\"'+userpage+'\"]').length ? 'your' : 'global'].append($(document.createElement('option')).attr('value',id).text(name));\n\t\t});\n\n\t\tif ($optg.your.children().length)\n\t\t\t$filterIDSelect.append($optg.your);\n\t\t$filterIDSelect.append($optg.global);\n\t\tif (settings.filterID){\n\t\t\tif ($filterIDSelect.find('option[value=\"'+settings.filterID+'\"]').length)\n\t\t\t\t$filterIDSelect.val(settings.filterID);\n\t\t\telse $filterIDSelect.val('???');\n\t\t}\n\t\telse $filterIDSelect.val('');\n\t});\n\n\t// Tag settings\n\t(function TagSettings(){\n\t\tlet possibleTags = ['safe','suggestive','questionable','explicit'],\n\t\t\ttagselectTimeout, tagselectCountdownInterval;\n\t\tif (LStorage.has('setting_allowed_tags')){\n\t\t\tlet setTags = LStorage.get('setting_allowed_tags').split(',');\n\t\t\t$.each(setTags,function(i,el){\n\t\t\t\tif (possibleTags.indexOf(el) > -1)\n\t\t\t\t\tsettings.allowedTags.push(el);\n\t\t\t});\n\t\t\tif (settings.allowedTags.length > 0) LStorage.set('setting_allowed_tags',settings.allowedTags.join(','));\n\t\t}\n\t\tif (settings.allowedTags.length === 0){\n\t\t\tLStorage.set('setting_allowed_tags','safe');\n\t\t\tsettings.allowedTags = ['safe'];\n\t\t}\n\t\tlet $systags = $settings.find('.systags');\n\t\t$.each(possibleTags,function(i,el){\n\t\t\t$systags.append(\n\t\t\t\t$(document.createElement('label')).append(\n\t\t\t\t\t$(document.createElement('input')).attr({\n\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\tname: el,\n\t\t\t\t\t\tchecked: settings.allowedTags.indexOf(el) > -1,\n\t\t\t\t\t}),\n\t\t\t\t\t'<span>'+el+'</span>'\n\t\t\t\t)\n\t\t\t);\n\t\t});\n\t\tfunction tagSelectCountdownStarter(){\n\t\t\tif (typeof tagselectTimeout === 'number'){\n\t\t\t\tclearInterval(tagselectTimeout);\n\t\t\t\t//noinspection JSUnusedAssignment\n\t\t\t\ttagselectTimeout = undefined;\n\t\t\t}\n\t\t\tif (typeof tagselectCountdownInterval === \"number\"){\n\t\t\t\tclearInterval(tagselectCountdownInterval);\n\t\t\t\ttagselectCountdownInterval = undefined;\n\t\t\t}\n\n\t\t\tlet i = 6,\n\t\t\t\ttagSelectCountdown = function(){\n\t\t\t\t\tif (--i === 0) return clearInterval(tagselectCountdownInterval);\n\n\t\t\t\t\tlet $elem = $tagSettings.find('.re-request span').text(i+' second'+(i !== 1 ? 's':'')).parent();\n\t\t\t\t\tif (!$elem.is(':visible')) $elem.stop().hide().slideDown();\n\t\t\t\t},\n\t\t\t\ttagArray = [];\n\n\t\t\ttagselectCountdownInterval = setInterval(tagSelectCountdown,1000);\n\t\t\ttagSelectCountdown();\n\t\t\ttagselectTimeout = setTimeout(function(){\n\t\t\t\t$systags.children().each(function(i,el){\n\t\t\t\t\tlet $input = $(el).find('input'),\n\t\t\t\t\t\ttag = $input.attr('name');\n\t\t\t\t\tif ($input.prop('checked'))\n\t\t\t\t\t\ttagArray.push(tag);\n\t\t\t\t});\n\n\t\t\t\tlet tagsCond = tagArray.length > 0,\n\t\t\t\t\tval = parseInt($filterID.val(), 10),\n\t\t\t\t\tfilterCond = !isNaN(val);\n\n\t\t\t\tif (tagsCond){\n\t\t\t\t\tsettings.allowedTags = tagArray;\n\t\t\t\t\tLStorage.set('setting_allowed_tags',tagArray.join(','));\n\t\t\t\t}\n\t\t\t\tif (filterCond){\n\t\t\t\t\tsettings.filterID = val;\n\t\t\t\t\tLStorage.set('setting_filterid',settings.filterID);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t$usefilterInput.prop('checked', false);\n\t\t\t\t\tsettings.filterID = undefined;\n\t\t\t\t\tLStorage.del('setting_filterid');\n\t\t\t\t}\n\t\t\t\tif (tagsCond || filterCond){\n\t\t\t\t\t$image.css('opacity','0');\n\t\t\t\t\t$imageGhost.css('opacity','0');\n\t\t\t\t\tunbindHandlers();\n\n\t\t\t\t\tsetTimeout(reQuest,300);\n\t\t\t\t}\n\t\t\t}, 5000);\n\t\t}\n\t\t$settings.find('.systags label span').on('click',function(e){\n\t\t\te.preventDefault();\n\n\t\t\tlet $thisInput = $(this).prev();\n\t\t\t$thisInput.prop('checked',!$thisInput.prop('checked'));\n\n\t\t\ttagSelectCountdownStarter();\n\t\t});\n\n\t\tif (LStorage.has('setting_filterid')){\n\t\t\tlet filterid = parseInt(LStorage.get('setting_filterid'), 10);\n\t\t\tif (isNaN(filterid))\n\t\t\t\tLStorage.del('setting_filterid');\n\t\t\telse {\n\t\t\t\tsettings.filterID = filterid;\n\t\t\t\t$usefilterInput.prop('checked', true);\n\t\t\t\t$filterID.val(settings.filterID).trigger('change');\n\t\t\t}\n\t\t}\n\t\tif (settings.allowedTags.length === 0){\n\t\t\tLStorage.set('setting_allowed_tags','safe');\n\t\t\tsettings.allowedTags = ['safe'];\n\t\t}\n\t\t$usefilterInput.on('click',function(){\n\t\t\tlet $this = $(this),\n\t\t\t\tchecked = $this.prop('checked');\n\n\t\t\tif (!checked)\n\t\t\t\t$filterID.val('').trigger('change');\n\t\t});\n\t\t$filterIDSelect.on('change keyup',function(){\n\t\t\tlet val = $filterIDSelect.val();\n\t\t\tif (val && /^\\d+$/.test(val)){\n\t\t\t\tif ($usefilterInput.prop('checked') !== true)\n\t\t\t\t\t$usefilterInput.prop('checked', true);\n\t\t\t\t$filterID.val(val).trigger('change');\n\t\t\t}\n\t\t});\n\t\t$filterID.on('change keyup',function(){\n\t\t\tif ($filterIDSelect.find('option[value=\"'+$filterID.val()+'\"]').length)\n\t\t\t\t$filterIDSelect.val($filterID.val());\n\t\t\telse $filterIDSelect.val('???');\n\t\t\tif (!$filterID.is(':valid'))\n\t\t\t\treturn;\n\n\t\t\tlet currFilter = settings.filterID ? settings.filterID : '';\n\t\t\tif ($filterID.val() !== currFilter)\n\t\t\t\ttagSelectCountdownStarter();\n\t\t});\n\t})();\n\t// Metadata settings\n\t(function MatadataSettings(){\n\t\tlet $inputs = $metaSettings.find('.switch input'), keys;\n\t\t$inputs.each(function(){\n\t\t\tsettings.metadata[this.name] = false;\n\t\t});\n\t\t\n\t\tif (!LStorage.has('setting_metadata')){\n\t\t\tkeys = Object.keys(settings.metadata);\n\t\t\tLStorage.set('setting_metadata',keys.join(','));\n\t\t}\n\t\telse {\n\t\t\tkeys = LStorage.get('setting_metadata');\n\t\t\tif (keys.length === 0) keys = [];\n\t\t\telse keys = keys.split(',');\n\t\t}\n\t\t\n\t\t$.each(keys,function(i,el){\n\t\t\tif (typeof settings.metadata[el] !== 'undefined')\n\t\t\t\tsettings.metadata[el] = true;\n\t\t\telse delete keys[i];\n\t\t});\n\t\t\n\t\tfunction updateMetadataSettings(noupdatekeys){\n\t\t\tif (noupdatekeys !== true) LStorage.set('setting_metadata',keys.join(','));\n\t\t\t\n\t\t\t$inputs.each(function(){\n\t\t\t\t$('#data .'+this.name.substring(4))[keys.indexOf(this.name) > -1?'show':'hide']();\n\t\t\t});\n\t\t\t\n\t\t\t$data.find('p span').filter(':visible').addClass('visible').last().removeClass('visible');\n\t\t}\n\t\twindow.updateMetadataSettings = function(){ updateMetadataSettings() };\n\t\t\n\t\tupdateMetadataSettings();\n\t\t\n\t\t$inputs.each(function(){\n\t\t\tthis.checked = !!settings.metadata[this.name];\n\t\t\t$(this).prop('checked',this.checked);\n\t\t});\n\t\t$metaSettings.find('.switch input').on('click',function(e){\n\t\t\te.stopPropagation();\n\t\t\t\n\t\t\tlet nameAttr = this.name,\n\t\t\t\tattrIndx = keys.indexOf(nameAttr);\n\t\t\t\n\t\t\tif (attrIndx === -1) keys.push(nameAttr);\n\t\t\telse keys.splice(attrIndx, 1);\n\t\t\t\n\t\t\tupdateMetadataSettings();\n\t\t});\n\t})();\n\t// Image cropping settings\n\t(function ImageCroppingSettings(){\n\t\tlet $select = $cropSettings.find('.input-field select');\n\n\t\tif (!LStorage.has('setting_crop')){\n\t\t\tsettings.crop = 'contain';\n\t\t\tLStorage.set('setting_crop', settings.crop);\n\t\t}\n\t\telse settings.crop = LStorage.get('setting_crop');\n\n\t\tfunction updateCroppingSettings(){\n\t\t\tlet setTo = settings.crop;\n\t\t\tif (['contain','cover','100% 100%'].indexOf(setTo) === -1)\n\t\t\t\tsetTo = 'cover';\n\n\t\t\tLStorage.set('setting_crop', setTo);\n\t\t\tsettings.crop = setTo;\n\t\t\t$select.val(setTo);\n\t\t\tsetBackgroundStyles();\n\t\t}\n\t\twindow.updateCroppingSettings = function(){ updateCroppingSettings() };\n\n\t\tupdateCroppingSettings();\n\n\t\t$select.on('change',function(){\n\t\t\tsettings.crop = $select.val();\n\n\t\t\tupdateCroppingSettings();\n\t\t});\n\t})();\n\n\t// Background size updater\n\tfunction setBackgroundStyles(image_url){\n\t\tif (typeof image_url === 'string')\n\t\t\t_currentImageURL = image_url;\n\t\telse if (typeof _currentImageURL !== 'string')\n\t\t\treturn;\n\t\tlet url = _currentImageURL.replace(/\"/g, '%22'),\n\t\t\tstyles = '#image{background-image:url(\"'+url+'\");background-size:'+settings.crop+'}';\n\t\tif (settings.crop === 'contain'){\n\t\t\t$imageGhost.css('opacity','');\n\t\t\tstyles += '#image-ghost{display:block;background-image:url(\"'+url+'\")}';\n\t\t}\n\n\t\t$style.html(styles);\n\t}\n\n\t// Begin site\n\tif (LStorage.has(\"image_data\") && LStorage.has(\"image_hash\")){\n\t\tsetBackgroundStyles(LStorage.get(\"image_data\"));\n\t\t$image.css('opacity','1').attr('data-hash',LStorage.get('image_hash'));\n\t}\n\n\treQuest();\n\n\t$data.html('<h1>Requesting metadata...</h1>').css('opacity', 1);\n\tfunction reQuest(page){\n\t\t$body.removeClass('notloading');\n\t\t$tagSettings.find('.re-request:visible').slideUp();\n\t\t\n\t\t$.ajax({\n\t\t\turl: 'https://trixiebooru.org/search.json'+\n\t\t\t        '?filter_id='+(settings.filterID||everythingFilterID)+\n\t\t\t        '&q=wallpaper+%26%26+('+settings.allowedTags.join('+%7C%7C+')+')+%26%26+-equestria+girls'+\n\t\t\t        (typeof page === 'number' ? '&page='+page : ''),\n\t\t\tsuccess: function(data){\n\t\t\t\tlet image, imgElement = new Image(), i = -1;\n\t\t\t\t\n\t\t\t\tdata = data.search;\n\t\t\t\t\n\t\t\t\tif (data.length === 0) {\n\t\t\t\t\tfadeIt();\n\t\t\t\t\t$body.addClass('notloading');\n\t\t\t\t\t$data.html('<h1>Search returned no results.</h1>' + (settings.allowedTags.indexOf('safe') === -1 ? '<p>Try enabling the safe system tag.</p>' : ''));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twhile (++i < data.length-1){\n\t\t\t\t\t// Optimal size images are above 720p and below 4096px in width & height, since larger images will make the browser lag\n\t\t\t\t\tif (data[i].width >= 1280 && data[i].height >= 720 && data[i].width <= 4096 && data[i].height <= 4096){\n\t\t\t\t\t\timage = data[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$body.addClass('notloading');\n\t\t\t\t\n\t\t\t\tif (typeof image === 'undefined')\n\t\t\t\t\treturn reQuest(typeof page === 'number' ? page+1 : 2);\n\t\t\t\t\n\t\t\t\tif (!LStorage.has(\"image_hash\") || LStorage.get(\"image_hash\") !== image.sha512_hash){\n\t\t\t\t\tif (typeof page === 'undefined')\n\t\t\t\t\t\t$data.html('<h1>Searching for new image...</h1>').css('opacity','1');\n\t\t\t\t\t\n\t\t\t\t\timgElement.src = 'http:'+image.image;\n\t\t\t\t\t$(imgElement).on('load',function(){\n\t\t\t\t\t\t// Save image into localStorage\n\t\t\t\t\t\tLStorage.set(\"image_data\", imgElement.src);\n\t\t\t\t\t\tLStorage.set(\"image_hash\", image.sha512_hash);\n\t\t\t\t\t\t\n\t\t\t\t\t\tmetadata(image, imgElement.src);\n\t\t\t\t\t}).on('error', function(){\n\t\t\t\t\t\tif (!image.is_rendered)\n\t\t\t\t\t\t\t$data.html('<h1>Image has not been rendered yet</h1><p>Try reloading in a minute or so</p>');\n\t\t\t\t\t\telse $data.html('<h1>Image failed to load</h1><p>Either the image is no longer available or the extension is broken</p>');\n\t\t\t\t\t\tfadeIt();\n\t\t\t\t\t\treturn reQuest(typeof page === 'number' ? page+1 : 2);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse metadata(image, getCachedIMGURL());\n\t\t\t},\n\t\t\terror: function(){\n\t\t\t\t$body.addClass('notloading');\n\t\t\t\t$data.html('<h1>There was an error while fetching the image data</h1><p>'+(navigator.onLine ? 'Derpibooru may be down for maintenance, try again later.' : 'You are not conected to the Internet.')+'</p>');\n\t\t\t}\n\t\t});\n\t\t\n\t\tfunction metadata(image,cachedurl){\n\t\t\tlet tags = image.tags.split(', '),\n\t\t\t\tartists = [];\n\t\t\t\n\t\t\t$.each(tags,function(i,el){\n\t\t\t\tif (el.indexOf('artist:') === 0)\n\t\t\t\t\tartists.push(el.substring(7));\n\t\t\t});\n\t\t\t\n\t\t\tlet artistText = artists.length ? 'By '+textify(artists) : 'Artist unknown';\n\t\t\t\n\t\t\t$data.empty().append('<h1><a href=\"https://derpibooru.org/'+image.id+'\">'+artistText+'</a></h1>');\n\n\t\t\t$data.children('h1').simplemarquee({\n\t\t\t    speed: 25,\n\t\t\t    cycles: Infinity,\n\t\t\t    space: 25,\n\t\t\t    handleHover: false,\n\t\t\t    delayBetweenCycles: 0,\n\t\t\t});\n\t\t\t\n\t\t\tlet votestr = '',\n\t\t\t\tcc = image.comment_count,\n\t\t\t\tfc = image.faves;\n\t\t\tif (image.upvotes + image.downvotes === 0) votestr = 'no votes';\n\t\t\telse {\n\t\t\t\tif (image.upvotes > 0){\n\t\t\t\t\tvotestr += image.upvotes+' upvote';\n\t\t\t\t\tif (image.upvotes > 1) votestr += 's';\n\t\t\t\t\tif (image.downvotes > 0){\n\t\t\t\t\t\tvotestr += ' and '+image.downvotes+' downvote';\n\t\t\t\t\t\tif (image.downvotes > 1) votestr += 's';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (image.downvotes > 0) votestr += image.downvotes+' downvote'+(image.downvotes>1?'s':'');\n\t\t\t}\n\t\t\t\n\t\t\t$data.append(\n\t\t\t\t`<p>\n\t\t\t\t\t<span class=\"uploadtime visible\">uploaded <time datetime=\"${image.created_at}\"></time> by ${image.uploader}</span>\n\t\t\t\t\t<span class=\"votes\">${votestr}</span>\n\t\t\t\t\t<span class=\"comments\">${cc>0?cc:'no'} comment${cc!==1?'s':''}</span>\n\t\t\t\t\t<span class=\"faves\">${fc>0?fc:'no'} favorite${fc!==1?'s':''}</span>\n\t\t\t\t</p>`\n\t\t\t);\n\t\t\tupdateMetadataSettings();\n\t\t\twindow.updateTimesF();\n\n\t\t\tsetBackgroundStyles(cachedurl);\n\t\t\tfadeIt();\n\t\t\tfadeOutData();\n\t\t}\n\t\t\n\t\tlet movetimeout = false,\n\t\t\thideFunction = function(){\n\t\t\t\tif (!$fadeLayer.children('.hover').length)\n\t\t\t\t\t$fadeLayer.css('opacity', 0);\n\t\t\t\telse movetimeout = setTimeout(hideFunction, 2000);\n\t\t\t};\n\t\tfunction fadeIt(){\n\t\t\t$image.css('opacity', 1);\n\n\t\t\t$body.on('mousemove',$.throttle(100,function(){\n\t\t\t\tif (document.getElementById('dialog'))\n\t\t\t\t\treturn true;\n\t\t\t\t$fadeLayer.css('opacity','1');\n\t\t\t\t$fadeLayer.on('mouseenter','> *',function(){\n\t\t\t\t\t$(this).addClass('hover');\n\t\t\t\t}).on('mouseleave','> *',function(){\n\t\t\t\t\t$(this).removeClass('hover');\n\t\t\t\t});\n\t\t\t\tfadeOutData();\n\t\t\t}));\n\t\t\t$body.triggerHandler('mousemove');\n\t\t\t$showSettingsButton.attr('disabled', false).on('click',function(e){\n\t\t\t\te.preventDefault();\n\n\t\t\t\t$settingsWrap.toggleClass('open');\n\t\t\t\t$body.triggerHandler('mousemove');\n\t\t\t});\n\t\t}\n\t\t\n\t\tfunction fadeOutData(){\n\t\t\tif (movetimeout !== false){\n\t\t\t\tclearTimeout(movetimeout);\n\t\t\t\t//noinspection JSUnusedAssignment\n\t\t\t\tmovetimeout = false;\n\t\t\t}\n\t\t\tif (!$settingsWrap.hasClass('open'))\n\t\t\t\tmovetimeout = setTimeout(hideFunction, 2000);\n\t\t}\n\t}\n\n\tfunction unbindHandlers(){\n\t\t$body.off('mousemove');\n\t\t$showSettingsButton.off('click').attr('disabled', true);\n\t\t$settingsWrap.removeClass('open');\n\t}\n\t\n\tfunction getCachedIMGURL(){\n\t\treturn LStorage.get(\"image_data\");\n\t}\n\n\t// First run dialog\n\tif (!LStorage.has('firstrun')){\n\t\t$(document.createElement('div'))\n\t\t\t.attr('id','dialog')\n\t\t\t.html('<div id=\"dialog-inner\"><h1>Welcome to Derpi-New Tab</h1><p>To access the settings click the <i class=\"material-icons\">menu</i> icon in the bottom left of the browser window.<br><span style=\"color:rgba(255,255,255,.5)\">(this message is only displayed once)</span></p></div>')\n\t\t\t.children()\n\t\t\t.append($(document.createElement('button')).text('Got it').on('click',function(e){\n\t\t\t\te.preventDefault();\n\n\t\t\t\tLStorage.set('firstrun',1);\n\t\t\t\tlet $dialog = $('#dialog').addClass('gtfo');\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t$dialog.remove();\n\t\t\t\t}, 550);\n\t\t\t}))\n\t\t\t.end()\n\t\t\t.prependTo($body);\n\t}\n\n    $cropSettings.find('select').material_select();\n\t\t\n\t// List textifier\n\tfunction textify(list, append, separator){\n\t\tif (typeof append === 'undefined') append = 'and';\n\t\tif (typeof separator === 'undefined') separator = ',';\n\n\t\tlet list_str;\n\t\t\n\t\tif (typeof list === 'string') list = list.split(separator);\n\t\tif (list.length > 1){\n\t\t\tlist_str = list;\n\t\t\tlet list_str_len = list_str.length,\n\t\t\t\tmaxDest = list_str_len-3,\n\t\t\t\ti = 0;\n\t\t\tlist_str.splice(list_str_len-1,0,append);\n\t\t\twhile (i <= maxDest){\n\t\t\t\tif (i === list_str_len-1)\n\t\t\t\t\tcontinue;\n\t\t\t\tlist_str[i] += ',';\n\t\t\t\ti++;\n\t\t\t}\n\t\t\tlist_str = list_str.join(' ');\n\t\t}\n\t\telse list_str = list[0];\n\t\treturn list_str;\n\t}\n});\n"]}